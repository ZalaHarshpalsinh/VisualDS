var VisualDS=function(t){"use strict";const e=800,i=600,a=1e3,n=750,s=10,h=20,r=40,o="18px sans-serif",l="azure";class d{constructor(){}enter(t){}exit(){}update(t){}draw(t){}}class c{constructor(t,e){this.states=t||{},this.currentState=t[e]()}change(t,e){this.currentState.exit(),this.currentState=this.states[t](),this.currentState.enter(e)}update(t){this.currentState.update(t)}draw(t){this.currentState.draw(t)}}function g(t,e,i,a,n,s,h,r){t.save(),t.fillStyle=s,t.fillRect(e,i,a,n),t.lineWidth=r,t.strokeStyle=h,t.strokeRect(e,i,a,n),t.restore()}function u(t,e,i,a,n,s,h,r){t.save(),t.font=n,t.fillStyle=s,t.textAlign=h,t.textBaseline=r,t.fillText(e,i,a),t.restore()}function p(t,e,i,a,n,s,h){t.save(),t.strokeStyle=s,t.lineWidth=h,t.beginPath(),t.moveTo(e,i),t.lineTo(a,n),t.stroke(),t.restore()}function m(t,e){const i=document.createElement("canvas").getContext("2d");i.font=t;let a=i.measureText(e);return{width:a.width,height:a.actualBoundingBoxAscent+a.actualBoundingBoxDescent}}class x{constructor(t,e,i,a,n,s,h){this.target=t,this.startValues=e,this.changeValues=i,this.startTime=a,this.duration=n,this.easing=s,this.callback=h}}class w{constructor(){this.animatorId=S()+1,this.tweens=new Map,this.nextId=1}addTween(t,e,i,a=w.linear,n=null){const s=this.nextId++,h={},r={},o=performance.now();i/=M(this.animatorId);for(const i in e)h[i]=t[i],r[i]=e[i]-h[i];return this.tweens.set(s,new x(t,h,r,o,i,a,n)),s}cancel(t){this.tweens.delete(t)}cancelAll(){this.tweens.clear()}update(t){const e=performance.now(),i=[];this.tweens.forEach(((t,a)=>{const n=e-t.startTime,s=Math.min(n/t.duration,1),h=t.easing(s);for(const e in t.changeValues)t.target[e]=t.startValues[e]+t.changeValues[e]*h;s>=1&&(i.push(a),t.callback&&t.callback())})),i.forEach((t=>this.tweens.delete(t)))}isActive(t){return!!this.tweens.get(t)}}w.linear=t=>t,w.quadIn=t=>t*t,w.quadOut=t=>t*(2-t),w.quadInOut=t=>t<.5?2*t*t:(4-2*t)*t-1,w.cubicIn=t=>t*t*t,w.cubicOut=t=>--t*t*t+1,w.cubicInOut=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,w.sinIn=t=>1-Math.cos(t*Math.PI/2),w.sinOut=t=>Math.sin(t*Math.PI/2),w.sinInOut=t=>(1-Math.cos(Math.PI*t))/2,w.expoIn=t=>0===t?0:Math.pow(2,10*(t-1)),w.expoOut=t=>1===t?1:1-Math.pow(2,-10*t),w.expoInOut=t=>0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t));class y{constructor(t,e){this.entity=t,this.params=e}}class v{constructor(t,e){this.type=t,this.params=e}}class f{constructor(t,e){this.brush={x:s,y:h},this.dsPool=[],this.animationQueue=[],this.state="idle",this.animationSpeed=1,this.tweenManager=new w,this.canvas=t,this.context=e,this.scroll={isScrolling:!1,x:0,y:0,lastX:0,lastY:0},this.zoomLevel=1,this.configureCanvas()}configureCanvas(){this.canvas.width=a,this.canvas.height=n,this.context.scale(a/e,n/i),this.canvas.addEventListener("mousedown",(t=>{t.preventDefault(),this.scroll.isScrolling=!0,this.scroll.lastX=t.clientX,this.scroll.lastY=t.clientY,this.canvas.style.cursor="grabbing"})),this.canvas.addEventListener("mousemove",(t=>{if(t.preventDefault(),!this.scroll.isScrolling)return;const e=t.clientX-this.scroll.lastX,i=t.clientY-this.scroll.lastY;this.scroll.x+=e,this.scroll.y+=i,this.scroll.lastX=t.clientX,this.scroll.lastY=t.clientY})),this.canvas.addEventListener("mouseup",(t=>{t.preventDefault(),this.scroll.isScrolling=!1,this.canvas.style.cursor="grab"})),this.canvas.addEventListener("wheel",(t=>{t.preventDefault(),t.deltaY<0?this.zoomLevel*=1.1:this.zoomLevel/=1.1,this.zoomLevel=Math.max(.1,Math.min(5,this.zoomLevel))}))}getTweenManager(){return this.tweenManager}addInPool(t){this.addAnimation(new v("add",{entity:t}))}removeFromPool(t){this.addAnimation(new v("remove",{entity:t}))}addAnimation(t){this.animationQueue.push(t)}nextAnimation(){setTimeout((()=>this.state="idle"),400/this.getAnimationSpeed())}getAnimationSpeed(){return this.animationSpeed}setAnimationSpeed(t){this.addAnimation(new v("change_speed",{newSpeed:t}))}setScroll(t,e){this.scroll.x=t,this.scroll.y=e}setZoom(t){this.zoomLevel=Math.max(.1,Math.min(5,t))}compactEntities(){this.brush.x=s,this.brush.y=h,this.dsPool.forEach((t=>{let e=t.getCoordinates(),i=!0;e.x==this.brush.x&&e.y==this.brush.y||(this.tweenManager.addTween(t,{x:this.brush.x,y:this.brush.y},300,w.linear,(()=>{i&&this.nextAnimation()})),i=!1),this.brush.y+=t.height+r}))}update(t){let e;"idle"==this.state&&void 0!==(e=this.animationQueue.shift())&&(this.state="animating",!function(t){return t.hasOwnProperty("type")}(e)?e.entity.notify(e.params):"add"==e.type?(e.params.entity.setCoordinates(this.brush.x,this.brush.y),this.brush.y+=e.params.entity.height+r,this.dsPool.push(e.params.entity),this.nextAnimation()):"remove"==e.type?(this.dsPool.splice(this.dsPool.indexOf(e.params.entity),1),this.compactEntities(),e.params.entity.cleanUp(),this.nextAnimation()):"change_speed"==e.type?(this.animationSpeed=e.params.newSpeed,this.nextAnimation()):(console.log("Invalid command"),this.nextAnimation())),this.dsPool.forEach((e=>{e.update(t)})),this.tweenManager.update(t)}draw(){this.context.save(),this.context.clearRect(0,0,e,i),this.context.translate(this.scroll.x,this.scroll.y),this.context.scale(a/e*this.zoomLevel,n/i*this.zoomLevel),this.dsPool.forEach((t=>{t.draw(this.context)})),this.context.restore()}}let b=[];function S(){return b.length-1}let I=0;function A(t){let e=(t-I)/1e3;I=t,function(t){b.forEach((e=>e.update(t)))}(e),b.forEach((t=>t.draw())),requestAnimationFrame(A)}function M(t){return b[t].getAnimationSpeed()}function D(t,e){b[t].setAnimationSpeed(e)}class P{constructor(){this.animatorId=S(),this.x=0,this.y=0,this.width=0,this.height=0,this.removed=!1}setCoordinates(t,e){this.x=t,this.y=e}getCoordinates(){return{x:this.x,y:this.y}}addInPool(){var t,e;t=this.animatorId,e=this,b[t].addInPool(e)}remove(){var t,e;this.removed=!0,t=this.animatorId,e=this,b[t].removeFromPool(e)}addAnimation(t){if(this.removed)return;const e=new y(this,t);!function(t,e){b[t].addAnimation(e)}(this.animatorId,e)}notify(t){}nextAnimation(){var t;t=this.animatorId,b[t].nextAnimation()}getAnimationSpeed(){return M(this.animatorId)}setAnimationSpeed(t){D(this.animatorId,t)}getTweenManager(){return t=this.animatorId,b[t].getTweenManager();var t}update(t){}draw(t){}cleanUp(){}}class O extends d{constructor(t){super(),this.velement=t}}class T extends d{constructor(t){super(),this.velement=t}enter(t){this.data=t,"box_color_change"==this.data.type?this.velement.color=this.data.color:"value_update"==this.data.type&&(this.velement.drawVal=this.data.newVal,this.velement.text=this.velement.drawVal?this.velement.drawVal.toString().split("\n"):["0"],this.velement.syncDataAndVisual()),this.velement.changeState("idle"),this.velement.nextAnimation()}}class _ extends P{constructor(t,e="",i=!1){super(),this.val=t,this.drawVal=t,this.label=e,this.color=l,this.font=o,this.labelFont="bold 10px Arial",this.text=this.drawVal?this.drawVal.toString().split("\n"):["0"],this.syncDataAndVisual(),i||super.addInPool(),this.stateMachine=new c({idle:()=>new O(this),property_change:()=>new T(this)},"idle")}update(t){this.stateMachine.update(t)}draw(t){g(t,this.x,this.y,this.width,this.height,this.color,"black",2);let e=this.x+this.width/2,i=this.y+8;this.text.forEach((a=>{u(t,a,e,i,this.font,"black","center","hanging"),i+=m(this.font,a).height+5})),i-=5,i+=8,this.label&&(p(t,this.x,i,this.x+this.width,i,"black",2),i+=8,u(t,this.label,e,i,this.labelFont,"black","center","hanging"))}notify(t){let{toState:e,enterParams:i}=t;this.stateMachine.change(e,i)}changeState(t,e){this.stateMachine.change(t,e)}syncDataAndVisual(){if(this.label){let t=m(this.labelFont,this.label);this.width=t.width,this.height=t.height+16}else this.width=0,this.height=0;this.text.forEach((t=>{let e=m(this.font,t);this.width=Math.max(this.width,e.width),this.height+=e.height+5})),this.width+=16,this.height-=5,this.height+=16}setVal(t,e=!0){this.val=t,e&&this.highlight("MediumOrchid"),this.addAnimation({toState:"property_change",enterParams:{type:"value_update",newVal:t}}),e&&this.unhighlight()}getVal(){return this.val}highlight(t){this.addAnimation({toState:"property_change",enterParams:{type:"box_color_change",color:t}})}unhighlight(){this.addAnimation({toState:"property_change",enterParams:{type:"box_color_change",color:l}})}remove(){super.remove()}cleanUp(){this.drawVal=null,this.text=null,this.stateMachine=null}}class E extends d{constructor(t){super(),this.varray=t}}class B extends d{constructor(t){super(),this.varray=t}enter(t){"box_color_change"==t.type?t.indices.forEach((e=>{e<this.varray.drawData.length&&(this.varray.drawData[e].color=t.toColor)})):"add_pointer"==t.type?this.varray.pointers.push(t.pointer):"remove_pointer"==t.type&&(t.pointer.cleanUp(),this.varray.pointers.splice(this.varray.pointers.indexOf(t.pointer),1)),this.varray.changeState("idle"),this.varray.nextAnimation()}}class V extends d{constructor(t){super(),this.varray=t}enter(t){let{i:e,j:i}=t,a=this.varray.drawData[e],n=this.varray.drawData[i];this.varray.drawData[e]=n,this.varray.drawData[i]=a,this.varray.getTweenManager().addTween(a,{x:n.x},400,w.linear),this.varray.getTweenManager().addTween(n,{x:a.x},400,w.linear,(()=>{this.varray.changeState("idle"),this.varray.nextAnimation()}))}}class k extends d{constructor(t){super(),this.varray=t,this.spawnDistance=400}enter(t){let{type:e,val:i}=t,a=`[${this.varray.drawData.length}]`;"front"==e?this.varray.drawData.unshift(new _(i,a,!0)):this.varray.drawData.push(new _(i,a,!0)),this.varray.syncDimensions(),this.varray.syncCoordinates();let n=this.varray.drawData["front"==e?0:this.varray.drawData.length-1],s=n.getCoordinates(),h={x:0,y:0};h="front"==e?{x:this.varray.x-this.varray.boxWidth-this.spawnDistance,y:this.varray.y}:{x:this.varray.x+this.varray.width-this.varray.boxWidth+this.spawnDistance,y:this.varray.y},n.setCoordinates(h.x,h.y),this.varray.getTweenManager().addTween(n,{x:s.x},500,w.cubicOut,(()=>{this.varray.changeState("idle"),this.varray.nextAnimation()}))}}class C extends d{constructor(t){super(),this.varray=t,this.killDistance=400}enter(t){let{type:e}=t,i=this.varray.drawData["front"==e?0:this.varray.drawData.length-1],a=i.x+("front"==e?-this.killDistance:+this.killDistance);this.varray.getTweenManager().addTween(i,{x:a},500,w.cubicIn,(()=>{"front"==e?this.varray.drawData.shift():this.varray.drawData.pop(),this.varray.changeState("idle"),this.varray.nextAnimation()}))}}class R extends P{constructor(t,e=""){super(),this.data=[],this.label=e,this.drawData=[],this.pointers=[],this.boxWidth=0,this.boxHeight=0,this.width=0,this.height=0;for(let e=0;e<t.length;e++)this.data.push(t[e]),this.drawData.push(new _(t[e],`[${e}]`,!0));this.syncDimensions(),super.addInPool(),this.stateMachine=new c({idle:()=>new E(this),property_change:()=>new B(this),swap:()=>new V(this),push:()=>new k(this),pop:()=>new C(this)},"idle")}updateBoxes(t){this.drawData.forEach((e=>{e.update(t)}))}updatePointers(t){this.pointers.forEach((e=>{e.update(t)}))}update(t){this.updateBoxes(t),this.syncDimensions(),this.syncCoordinates(),this.updatePointers(t)}drawBoxes(t){this.drawData.forEach(((e,i)=>{e.draw(t)}))}drawPointers(t){this.pointers.forEach((e=>{e.draw(t)}))}draw(t){u(t,this.label,this.x+this.width/2,this.y-15,"bold 12px Arial","black","center","hanging"),this.drawBoxes(t),this.drawPointers(t)}notify(t){let{toState:e,enterParams:i}=t;this.changeState(e,i)}changeState(t,e){this.stateMachine.change(t,e)}syncDimensions(){for(let t=0;t<this.drawData.length;t++)this.boxWidth=Math.max(this.boxWidth,this.drawData[t].width),this.boxHeight=Math.max(this.boxHeight,this.drawData[t].height);for(let t=0;t<this.drawData.length;t++)this.drawData[t].width=this.boxWidth,this.drawData[t].height=this.boxHeight;this.width=this.drawData.length*this.boxWidth,this.height=this.boxHeight}syncCoordinates(){let t={x:this.x,y:this.y};for(let e=0;e<this.drawData.length;e++)this.drawData[e].setCoordinates(t.x,t.y),this.drawData[e].label=`[${e}]`,t.x+=this.boxWidth}length(){return this.data.length}get(t){return this.data[t]}set(t,e,i=!0){this.data[t]=e,this.drawData[t].setVal(e,i)}pushBack(t){return super.addAnimation({toState:"push",enterParams:{type:"back",val:t}}),this.data.push(t)}popBack(){return super.addAnimation({toState:"pop",enterParams:{type:"back"}}),this.data.pop()}pushFront(t){return super.addAnimation({toState:"push",enterParams:{type:"front",val:t}}),this.data.unshift(t)}popFront(){return super.addAnimation({toState:"pop",enterParams:{type:"front"}}),this.data.shift()}highlight(t,e="blue"){const i={type:"box_color_change",indices:t,toColor:e};super.addAnimation({toState:"property_change",enterParams:i})}unhighlight(t){this.highlight(t,l)}highlightRange(t,e,i){let a=[];for(let i=t;i<=e;i++)a.push(i);this.highlight(a,i)}unhighlightRange(t,e){let i=[];for(let a=t;a<=e;a++)i.push(a);this.unhighlight(i)}swap(t,e,i=!0){i&&this.highlight([t,e],"red");let a=this.data[t];this.data[t]=this.data[e],this.data[e]=a,super.addAnimation({toState:"swap",enterParams:{i:t,j:e}}),i&&this.unhighlight([t,e])}getPointer(t,e=""){const i=new F(this,t,e);return this.addAnimation({toState:"property_change",enterParams:{type:"add_pointer",pointer:i}}),i}removePointer(t){this.addAnimation({toState:"property_change",enterParams:{type:"remove_pointer",pointer:t}})}cleanUp(){this.drawData.forEach((t=>{t.removed=!0,t.cleanUp()})),this.drawData=[],this.pointers.forEach((t=>{t.removed=!0,t.cleanUp()})),this.pointers=[]}}class L extends d{constructor(t){super(),this.pointer=t}update(t){this.pointer.drawIndex=Math.max(-1,Math.min(this.pointer.pointee.drawData.length,this.pointer.drawIndex)),this.pointer.syncCoordinates()}}class W extends d{constructor(t){super(),this.pointer=t}enter(t){let e=t.change;this.pointer.drawIndex+=e;let i=this.pointer.x+e*this.pointer.pointee.boxWidth;this.pointer.getTweenManager().addTween(this.pointer,{x:i},500,w.linear,(()=>{this.pointer.changeState("idle"),this.pointer.nextAnimation()}))}}class F extends P{constructor(t,e,i=""){super(),this.pointee=t,this.index=e,this.drawIndex=Math.max(-1,Math.min(this.pointee.length(),e)),this.label=i,this.syncCoordinates(),this.stateMachine=new c({idle:()=>new L(this),moving:()=>new W(this)},"idle")}update(t){this.stateMachine.update(t)}drawArrow(t){u(t,"↑",this.x,this.y,"14px Arial","red","center","top"),u(t,`${this.label}${this.label?": ":""}${this.drawIndex}`,this.x,this.y+14,"9px Arial","blue","center","top")}draw(t){this.drawArrow(t)}notify(t){let{toState:e,enterParams:i}=t;this.changeState(e,i)}changeState(t,e){this.stateMachine.change(t,e)}syncCoordinates(){this.x=this.pointee.x+this.pointee.boxWidth/2+this.drawIndex*this.pointee.boxWidth,this.y=this.pointee.y+this.pointee.boxHeight}getIndex(){return this.index}isOutOfBound(){return this.index<0||this.index>=this.pointee.length()}move(t){let e=Math.max(-1,Math.min(this.pointee.length(),this.index));this.index+=t,0!=(t=Math.max(-1,Math.min(this.pointee.length(),this.index))-e)&&super.addAnimation({toState:"moving",enterParams:{change:t}})}moveTo(t){this.move(t-this.getIndex())}increment(){this.move(1)}decrement(){this.move(-1)}highlight(t="blue"){this.isOutOfBound()||this.pointee.highlight([this.index],t)}unhighlight(){this.isOutOfBound()||this.pointee.unhighlight([this.index])}remove(){this.removed=!0,this.pointee.removePointer(this)}cleanUp(){this.drawIndex=null,this.pointee=null,this.stateMachine=null}}return t.BaseState=d,t.Entity=P,t.StateMachine=c,t.TweenManager=w,t.binarySearch=function(t,e){let i=new R(t,"Binary Search");!function t(e,i,a,n){if(i>a)return;e.highlightRange(i,a);let s=Math.floor((i+a)/2);if(e.highlight([s],"red"),e.unhighlightRange(i,a),e.get(s)>n)t(e,i,s-1,n);else{if(!(e.get(s)<n))return void e.highlight([s],"green");t(e,s+1,a,n)}}(i,0,i.length()-1,e)},t.bubbleSort=function(t){let e=new R(t,"Bubble Sort");for(let t=e.getPointer(0,"I");!t.isOutOfBound()||t.remove();t.increment()){let i=!1;for(let a=e.getPointer(0,"J");a.getIndex()<e.length()-1-t.getIndex()||a.remove();a.increment())e.get(a.getIndex())>e.get(a.getIndex()+1)&&(i=!0,e.swap(a.getIndex(),a.getIndex()+1));if(e.highlight([e.length()-1-t.getIndex()],"green"),!i){let i=[];for(let t=0;t<e.length();t++)i.push(t);e.highlight(i,"green"),t.remove();break}}},t.createVisualisation=function(t,e){const i=document.getElementById(t),a=i.getContext("2d");let n=new f(i,a);b.push(n),e({setAnimationSpeed:t=>n.setAnimationSpeed(t),setZoom:t=>n.setZoom(t)}),0==S()&&requestAnimationFrame(A)},t.drawLine=p,t.drawRectangle=g,t.drawText=u,t.getAnimationSpeed=M,t.getTextDimensions=m,t.insertionSort=function(t){let e=new R(t,"Insertion Sort");e.highlight([0],"green");for(let t=e.getPointer(1,"I");!t.isOutOfBound()||t.remove();t.increment()){t.highlight();let i=e.getPointer(t.getIndex()-1,"J");for(;!i.isOutOfBound()&&e.get(i.getIndex())>e.get(i.getIndex()+1);)e.swap(i.getIndex(),i.getIndex()+1,!1),i.decrement();e.highlight([i.getIndex()+1],"green"),i.remove()}},t.linearSearch=function(t,e){let i=new R(t,"Linear Search");for(let t=i.getPointer(0,"I");!t.isOutOfBound()||t.remove();t.increment()){if(t.highlight(),i.get(t.getIndex())==e){t.highlight("green"),t.remove();break}t.unhighlight()}},t.mergeSort=function(t){let e=new R(t,"Merge Sort");!function t(e,i,a){if(e.highlightRange(i,a,"SpringGreen"),e.unhighlightRange(i,a),i===a)return;let n=Math.floor((i+a)/2);t(e,i,n),t(e,n+1,a),function(t,e,i,a){t.highlightRange(e,i,"Turquoise"),t.highlightRange(i+1,a,"Tomato");let n=[],s=[];for(let a=e;a<=i;a++)n.push(t.get(a));n.push("#");for(let e=i+1;e<=a;e++)s.push(t.get(e));s.push("#");let h=new R(n,"left"),r=new R(s,"right");h.highlightRange(0,h.length()-1,"Turquoise"),r.highlightRange(0,r.length()-1,"Tomato");for(let i=t.getPointer(e,"I");i.getIndex()<=a||i.remove();i.increment())"#"===r.get(0)||"#"!==h.get(0)&&h.get(0)<r.get(0)?t.set(i.getIndex(),h.popFront()):t.set(i.getIndex(),r.popFront());t.highlightRange(e,a,"green"),h.remove(),r.remove()}(e,i,n,a)}(e,0,e.length()-1)},t.selectionSort=function(t){let e=new R(t,"Selection Sort");for(let t=e.getPointer(0,"I");!t.isOutOfBound()||t.remove();t.increment()){let i=t.getIndex();t.highlight("green");for(let a=e.getPointer(t.getIndex()+1,"J");!a.isOutOfBound()||a.remove();a.increment())e.get(a.getIndex())<e.get(i)&&(e.unhighlight([i]),i=a.getIndex(),a.highlight("green"));e.swap(t.getIndex(),i,!1)}},t.setAnimationSpeed=D,t.vArray=R,t.vElement=_,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
